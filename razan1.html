<!DOCTYPE html>
<html>

<head>
    <style>
        :root {
            --color-bg: #050816;
            --color-surface-alt: #111827;
            --color-primary: #1f9cf0;
            --color-accent-orange: #ffb347;
            --color-accent-purple: #a855f7;
            --color-text-main: #e5e7eb;
                 
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 40px;
            background: radial-gradient(circle at top, #111827 0, var(--color-bg) 55%);
            color: var(--color-text-main);
        }

        .panel {
            background: linear-gradient(145deg,
                    rgba(31, 41, 55, 0.9),
                    rgba(15, 23, 42, 0.95));
            border-radius: 16px;
            padding: 20px 20px 18px;
            border: 1px solid var(--color-border);
            box-shadow:
                0 18px 40px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
        }

        .chart-area {
            width: 100%;
            min-height: 520px;
            background: radial-gradient(circle at top left,
                    rgba(31, 156, 240, 0.25),
                    rgba(15, 23, 42, 0.95));
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            font-size: 0.85rem;
            color: var(--color-text-muted);
            margin-bottom: 16px;
            position: relative;
            overflow: visible;
        } 
        .panel:hover .chart-area {
            border-color: var(--color-primary);
            box-shadow: 0 0 25px rgba(31, 156, 240, 0.4);
        }

        .panel-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--color-primary);
        }

        .axis-label {
            fill: var(--color-text-main);
            font-size: 0.85rem;
        }


        .tooltip {
            position: absolute;
            pointer-events: none;
            opacity: 0;
            background: rgba(15, 23, 42, 0.95);
            color: var(--color-text-main);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 0.75rem;
            line-height: 1.4;
            border: 1px solid rgba(148, 163, 184, 0.4);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
            z-index: 999;
            max-width: 240px;
        }

        .tooltip strong {
            color: var(--color-primary);
            display: block;
            margin-bottom: 4px;
        }

        .controls {
            margin: 10px 0 8px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 0.85rem;
        }

        .controls label {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .controls select {
            background: var(--color-surface-alt);
            color: var(--color-text-main);
            border-radius: 6px;
            border: 1px solid var(--color-border);
            padding: 4px 8px;
            font-size: 0.85rem;
        }

    </style>
    <meta charset="utf-8">
    <title></title>
</head>

<body>
  
        <div class="panel">
            <div class="panel-title">Mission Cost vs Duration</div>
            <div class="chart-area">
                <div class="controls">
                    <label>
                        Country:
                        <select id="countrySelect"></select>
                    </label>

                    <label>
                        Mission status:
                        <select id="statusSelect">
                            <option value="All">All</option>
                            <option value="Successful">Successful</option>
                            <option value="Failed">Failed</option>
                        </select>
                    </label>
                </div>
                <div id="bubbleChart"></div>
        </div>
 
        <div id="tooltip" class="tooltip"></div>

    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>

        d3.csv("Global_Space_Exploration_Dataset.csv").then(function (data) {

            const classifiedData = classifyMissions(data, 80)

            const countries = Array.from(new Set(data.map(d => d.Country)))
                .filter(d => d != null && d !== "")
                .sort(d3.ascending);

            const countrySelect = d3.select("#countrySelect");
            countrySelect.selectAll("option")
                .data(countries)
                .enter()
                .append("option")
                .attr("value", d => d)
                .text(d => d);
 
            const defaultCountry = countries[0];
            countrySelect.property("value", defaultCountry);

            const statusSelect = d3.select("#statusSelect");
            const defaultStatus = "All";
            statusSelect.property("value", defaultStatus);

            countrySelect.on("change", function () {
                const selectedCountry = this.value;
                const selectedStatus = statusSelect.property("value");
                drawBubbleChart(classifiedData, selectedCountry, selectedStatus);
            });

            statusSelect.on("change", function () {
                const selectedStatus = this.value;
                const selectedCountry = countrySelect.property("value");
                drawBubbleChart(classifiedData, selectedCountry, selectedStatus);
            });

          
            drawBubbleChart(classifiedData, 'China', 'All') 

        }).catch(function (error) {
            console.log(error);
        });

        function classifyMissions(data, threshold) {
            data.forEach(d => {
                const rate = +d["Success Rate (%)"];   
                d.status = rate >= threshold ? "Successful" : "Failed";
            });
            return data;
        }

        const tooltip = d3.select("#tooltip");


        // Bubble Chart
        // Reference: https://d3-graph-gallery.com/graph/bubble_tooltip.html

        function drawBubbleChart(data, selectedCountry, selectedStatus) {

            d3.select('#bubbleChart svg').remove();

            var countryData = data.filter(d => d.Country == selectedCountry)
            if (selectedStatus !== 'All') countryData = countryData.filter(d => d.status == selectedStatus)

            const margin = { top: 50, right: 50 , bottom: 90 , left: 50 },
                width = 500 - margin.left - margin.right,
                height = 520 - margin.top - margin.bottom;

            const svg = d3.select("#bubbleChart").append('svg')
                .attr("preserveAspectRatio", "xMinYMin meet")
                .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + " " + (height + margin.top + margin.bottom))
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


            const x = d3.scaleLinear()
                .domain(d3.extent(countryData, d => +d['Budget (in Billion $)']))
                .range([0, width]).nice();
            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x));

            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "middle")
                .attr("x", width / 2)
                .attr("y", height + 40)
                .text("Mission Cost (Billion USD)");

            const y = d3.scaleLinear()
                .domain(d3.extent(countryData, d => +d['Duration (in Days)']))
                .range([height, 0]).nice();
            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -35)
                .text("Mission Duration (Days)");

            const z = d3.scaleOrdinal()
                .domain(["Low", "Medium", "High"])
                .range([2, 5, 10]);;

            const missionColor = d3.scaleOrdinal()
                .domain(["Successful", "Failed"])
                .range(["#1f9cf0", "#ff6b8a"]);

            svg.append('g')
                .selectAll("dot")
                .data(countryData)
                .join("circle")
                .attr("class", "bubbles")
                .attr("cx", d => x(+d['Budget (in Billion $)']))
                .attr("cy", d => y(+d['Duration (in Days)']))
                .attr("r", d => z(d["Environmental Impact"]))
                .attr("stroke", 'black')
                .attr("stroke-width", '0.5px')
                .style("fill", d => missionColor(d.status))
                .on("mouseover", function (event, d) {
                    d3.select(this).attr("stroke", "#2dd4bf").attr("stroke-width", '3px');
                    tooltip
                        .style("opacity", 1)
                        .html(`
                    <strong>${d["Mission Name"]}</strong>
                    Launch year: ${d["Year"]}<br>
                    Cost: $${d['Budget (in Billion $)']}B<br>
                    Outcome: ${d.status}
                `);
                })
                .on("mousemove", (event, d) => {
                    tooltip
                        .style("left", (event.pageX + 15) + "px")
                        .style("top", (event.pageY + 15) + "px");
                })
                .on("mouseleave", function (event, d) {
                    d3.select(this).attr("stroke", 'black').attr("stroke-width", '0.5px');
                    tooltip.style("opacity", 0);
                });

            const legendData = ["Successful", "Failed"];

            const legend = svg.append("g")
                .attr("transform", `translate(${width / 2 - margin.right - margin.left}, ${height + 65})`);

            legend.selectAll("circle")
                .data(legendData)
                .join("circle")
                .attr("cx", (d, i) => i * 140 + 10)
                .attr("cy", 0)
                .attr("r", 6)
                .attr("fill", d => d === "Successful" ? "#1f9cf0" : "#ff6b8a");

            legend.selectAll("text")
                .data(legendData)
                .join("text")
                .attr("x", (d, i) => i * 140 + 25)
                .attr("y", 3)
                .style("font-size", "12px")
                .style("fill", "var(--color-text-main)")
                .text(d => d);

        }

    </script>
</body>

</html>
